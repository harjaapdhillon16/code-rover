name: AutoCodeRover Workflow

on:
  issues:
    types: [opened]

jobs:
  run-autocoderover:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3  # Updated to v3 for better compatibility

      # AutoCodeRover Step
      - name: Run AutoCodeRover
        run: |
          chmod +x clone_and_run.sh
          ./clone_and_run.sh \
              --task-id "${{ github.event.issue.number }}" \
              --clone-link "${{ github.event.repository.clone_url }}" \
              --commit-hash "${{ github.event.issue.pull_request.head.sha }}" \
              --issue-link "${{ github.event.issue.html_url }}" \
              "${{ github.repository }}" "${{ github.event.issue.title }}" "${{ github.event.issue.body }}"
          
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v4
        with:
          commit-message: "Auto-generated patch based on issue #${{ github.event.issue.number }}"
          title: "Auto-generated patch based on issue #${{ github.event.issue.number }}"
          branch: "autocoderover-patch-${{ github.event.issue.number }}"
          base: "main"   
          body: |
            This pull request contains an auto-generated patch based on issue #${{ github.event.issue.number }}. Please review the changes carefully before merging.
          labels: "auto-generated"
          delete-branch: true
